name: Monthly Release

on:
  schedule:
    - cron: '0 7 * * 6'

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
    - name: What day it it?
      id: date
      run: |
        echo "::set-output name=day::$(date +%d )"

    - name: Check date
      run: |
        echo ${{ steps.date.outputs.day }}

    - name: Get build version
      id: version
      uses: andstor/file-reader-action@v1
      with:
        path: "version.txt"

    - name: Commit tagger
      if: steps.date.outputs.day <= 7
      uses: tvdias/github-tagger@v0.0.2
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        tag: ${{ steps.version.outputs.contents }}

    - name: Call if
      if: steps.date.outputs.day <= 7
      env:
        CF_API_KEY: ${{ secrets.CF_API_KEY }}
        WOWI_API_TOKEN: ${{ secrets.WOWI_API_TOKEN }}
        GITHUB_OAUTH: ${{ secrets.GITHUB_TOKEN }}
      run: |
        sudo apt-get install pandoc
        curl -s https://raw.githubusercontent.com/Gethe/packager/RealUI/release.sh -o release.sh
        bash release.sh -L -p 88269 -w 16068
